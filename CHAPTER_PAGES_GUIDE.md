# 分页章节教材系统 - 完整说明

## 🎯 功能概述

全新的教材生成系统，实现：
- **大纲页面**：只显示结构化的教学大纲
- **章节页面**：每个章节独立一页，包含教材内容 + 专属练习题
- **章节导航**：侧边栏导航，可快速切换章节
- **进度追踪**：显示当前学习进度

## 📖 用户流程

```
1. 填写表单 → 生成大纲
   ↓
2. 查看大纲（单元标题、学习目标、章节列表）
   ↓
3. 确认大纲 → 逐章生成教材和练习题
   ↓
4. 章节浏览模式：
   - 左侧：章节导航（显示所有章节，标记当前/已完成）
   - 右侧：当前章节内容
     * 章节信息
     * 学习主题
     * 教材内容（Markdown渲染）
     * 本章练习题（3-5题）
     * 上一章/下一章按钮
   ↓
5. 逐章学习，完成所有章节
```

## 🏗️ 系统架构

### 后端架构

#### 1. **大纲生成** (`/api/generate-outline`)
返回JSON格式：
```json
{
  "title": "单元标题",
  "objectives": ["目标1", "目标2", "目标3"],
  "chapters": [
    {
      "chapter_number": 1,
      "title": "章节标题",
      "topics": ["主题1", "主题2"],
      "description": "章节描述"
    }
  ]
}
```

#### 2. **章节内容生成** (`/api/generate-content`)
逐章调用AI生成：
- **每章2次AI调用**：
  1. 生成章节内容（500-800字）
  2. 生成该章节的练习题（3-5题）

返回JSON格式：
```json
{
  "title": "单元标题",
  "objectives": ["目标1", "目标2"],
  "chapters": [
    {
      "chapter_number": 1,
      "title": "章节标题",
      "topics": ["主题1", "主题2"],
      "description": "章节描述",
      "content": "# 章节内容 Markdown...",
      "questions": "## 第1题\n..."
    }
  ]
}
```

#### 3. **进度追踪** (`/api/generation-progress/{id}`)
实时返回生成进度：
```json
{
  "current": 2,
  "total": 5,
  "status": "processing"
}
```

### 前端架构

#### 组件结构

1. **App.jsx** - 主应用
   - 状态管理
   - 流程控制（大纲 → 章节）
   - 进度轮询

2. **OutlineDisplay.jsx** - 大纲显示
   - 解析并美化显示JSON大纲
   - 单元标题、学习目标、章节卡片
   - 编辑功能

3. **ChapterDisplay.jsx** - 章节显示
   - 显示单个章节的完整信息
   - 教材内容（Markdown渲染）
   - 练习题（Markdown渲染）
   - 上一章/下一章导航

4. **ChapterNavigation.jsx** - 章节导航
   - 侧边栏章节列表
   - 当前章节高亮
   - 已完成章节标记
   - 点击跳转

5. **ProgressIndicator.jsx** - 进度显示
   - 进度条
   - 章节状态列表
   - 实时更新

## 🎨 页面布局

### 大纲页面
```
┌────────────────────────────────────┐
│     步骤: ①大纲 → ②教材           │
├────────────────────────────────────┤
│  教学大纲                         │
│  ┌──────────────────────────────┐│
│  │ # 分数基础概念               ││
│  │                               ││
│  │ ## 学习目标                  ││
│  │ 1. 认识分数...               ││
│  │ 2. 理解分数大小...           ││
│  │                               ││
│  │ ## 教学章节 (共5章)          ││
│  │ ┌─────────────────────────┐ ││
│  │ │ 第1章 │ 认识分数        │ ││
│  │ │ 描述... │ 主题标签...   │ ││
│  │ └─────────────────────────┘ ││
│  │ ┌─────────────────────────┐ ││
│  │ │ 第2章 │ ...             │ ││
│  │ └─────────────────────────┘ ││
│  └──────────────────────────────┘│
│  [ 确认大纲，逐章生成教材 (共5章) ]│
└────────────────────────────────────┘
```

### 章节浏览页面
```
┌─────────────────────────────────────────────────┐
│     步骤: ①大纲 → ②教材                         │
├──────────┬──────────────────────────────────────┤
│章节导航  │  第1章 / 共5章: 认识分数             │
│          │  [上一章] [下一章]                   │
│┌────────┐│  ────────────────────────────────────│
││✓ 第1章 ││  本章学习主题                        │
││  认识分 ││  [什么是分数] [分数组成] ...        │
││  数     ││  ────────────────────────────────────│
│├────────┤│  📖 教材内容                         │
││→ 第2章 ││  ┌──────────────────────────────┐  │
││  分数表 ││  │ # 认识分数                   │  │
││  示 当前││  │ 分数是表示部分与整体...      │  │
│├────────┤│  │ ## 什么是分数                │  │
││  第3章 ││  │ 内容详细说明...              │  │
││  ...   ││  └──────────────────────────────┘  │
│└────────┘│  ────────────────────────────────────│
│          │  ✏️ 本章练习题                      │
│          │  ┌──────────────────────────────┐  │
│          │  │ ## 第1题（选择题）           │  │
│          │  │ 题目内容...                  │  │
│          │  │ A) ... B) ... C) ... D) ...  │  │
│          │  │ **正确答案：** B             │  │
│          │  │ **详细解析：** ...           │  │
│          │  │ ───                          │  │
│          │  │ ## 第2题...                  │  │
│          │  └──────────────────────────────┘  │
│          │  ────────────────────────────────────│
│          │  学习进度: 2 / 5                    │
│          │  [上一章]            [下一章]       │
└──────────┴──────────────────────────────────────┘
```

## 🔧 技术实现

### AI 调用次数

如果大纲有 **5个章节**：
- 生成大纲：**1次** AI调用
- 生成教材：**5章 × 2次** = **10次** AI调用
  - 第1章内容：1次
  - 第1章练习题：1次
  - 第2章内容：1次
  - 第2章练习题：1次
  - ... 以此类推
- **总计：11次** AI调用

### 数据流

```
用户输入
  ↓
【大纲生成】
  → AI调用1次 → JSON大纲
  ↓
【确认大纲】
  ↓
【章节1生成】
  → AI调用(内容) → Markdown内容
  → AI调用(练习) → Markdown练习题
  → 更新进度 1/5
  ↓
【章节2生成】
  → AI调用(内容)
  → AI调用(练习)
  → 更新进度 2/5
  ↓
... 重复 ...
  ↓
【章节5生成】
  → AI调用(内容)
  → AI调用(练习)
  → 更新进度 5/5
  ↓
【完成】→ 显示章节浏览界面
```

### 进度更新机制

1. 后端在生成每章后调用 `progress_callback(current, total)`
2. 进度信息存储在内存字典 `generation_progress`
3. 前端每秒轮询 `/api/generation-progress/{id}`
4. 实时更新进度条和章节状态

## 📁 文件变更清单

### 后端文件（2个）
1. ✅ `backend/groq_service.py`
   - `generate_chapter_content()` - 返回 `{content, questions}` 字典
   - `generate_content()` - 返回完整的JSON结构

2. ✅ `backend/main.py`
   - 进度追踪逻辑保持不变

### 前端文件（新增/修改 4个）
1. ✅ `frontend/src/components/ChapterDisplay.jsx` - **新增**
2. ✅ `frontend/src/components/ChapterNavigation.jsx` - **新增**
3. ✅ `frontend/src/App.jsx` - **修改**
4. ✅ `frontend/src/components/OutlineDisplay.jsx` - 保持不变

### 删除的文件（2个）
- ❌ `ContentDisplay.jsx` - 不再需要
- ❌ `QuestionsDisplay.jsx` - 不再需要

## 🚀 使用方式

### 1. 重启后端
```bash
cd backend
python main.py
```

### 2. 前端自动刷新
浏览器会自动热重载，或手动刷新 (F5)

### 3. 测试流程
1. 填写"数学 - 国小三年级 - 分数基础概念"
2. 等待大纲生成（约5-10秒）
3. 查看结构化大纲（标题、目标、5个章节卡片）
4. 点击"确认大纲，逐章生成教材（共5章）"
5. 观察进度条：1/5 → 2/5 → ... → 5/5
6. 生成完成后进入章节浏览模式
7. 使用左侧导航或底部按钮切换章节
8. 每页显示：教材内容 + 3-5题练习

## 🎯 特色功能

### 1. **章节独立性**
- 每章有独立的内容和练习题
- 针对性强，便于学习和复习

### 2. **灵活导航**
- 侧边栏快速跳转
- 顶部和底部都有导航按钮
- 当前位置明确标识

### 3. **学习进度**
- 已完成章节打勾✓
- 当前章节高亮显示
- 进度百分比显示

### 4. **美观排版**
- Markdown渲染，格式清晰
- 卡片式布局，层次分明
- 响应式设计，移动端友好

## 📊 数据示例

### 生成的章节数据结构
```json
{
  "title": "分数基础概念",
  "objectives": [
    "认识分数的意义和表示方法",
    "理解分数的大小比较",
    "学会简单的分数运算"
  ],
  "chapters": [
    {
      "chapter_number": 1,
      "title": "认识分数",
      "topics": ["什么是分数", "分数的组成", "生活中的分数"],
      "description": "介绍分数的基本概念和日常应用",
      "content": "# 认识分数\n\n分数是表示部分与整体关系的数...",
      "questions": "## 第1题（选择题）\n下列哪个是分数？\n\nA) 3\nB) 1/2\nC) 0.5\nD) 50%\n\n**正确答案：** B\n\n**详细解析：**\n分数的标准形式是用分数线分隔的两个整数..."
    },
    {
      "chapter_number": 2,
      "title": "分数的表示",
      ...
    }
  ]
}
```

## 🔮 后续优化建议

1. **书签功能** - 记住用户上次学习的章节
2. **进度保存** - 标记每章的完成状态
3. **打印功能** - 支持打印单章或全部内容
4. **笔记功能** - 允许用户在章节上做笔记
5. **难度标记** - 为每章标注难度等级
6. **估计时间** - 显示每章预计学习时间
7. **互动练习** - 练习题支持在线作答和自动批改

## 💡 优势总结

1. ✅ **内容更详细** - 每章独立生成，AI有更多token空间
2. ✅ **针对性练习** - 每章练习题直接针对该章内容
3. ✅ **学习体验好** - 分页浏览，不会信息过载
4. ✅ **灵活导航** - 可随时跳转到任意章节
5. ✅ **进度可见** - 清楚知道学习进度
6. ✅ **易于复习** - 可单独复习某个章节
7. ✅ **专业排版** - Markdown渲染，视觉效果好

---

🎉 **现在开始使用新的分页章节系统，享受更好的学习体验！**

