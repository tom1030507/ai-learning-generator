# 可视化编辑大纲 - 说明文档

## 问题

之前点击"编辑"按钮后，用户需要直接编辑JSON格式的文本，对非技术用户非常不友好：

```json
{
  "title": "速率的概念與單位",
  "objectives": ["目標1", "目標2"],
  "chapters": [...]
}
```

## 解决方案

实现了**可视化表单编辑**功能，用户可以通过友好的界面编辑大纲。

## 新的编辑界面

### 1. 单元标题编辑
- 文本输入框
- 直接修改单元名称

### 2. 学习目标编辑
- 每个目标一个输入框
- **➕ 新增目标** 按钮
- **❌ 删除目标** 按钮（至少保留1个）
- 自动编号

### 3. 章节编辑
每个章节包含：
- **章节编号**（自动）
- **章节标题**（可编辑）
- **章节描述**（可编辑，多行文本）
- **学习主题**（可添加/删除多个）
  - 每个主题独立输入框
  - ➕ 新增主题
  - ❌ 删除主题（至少保留1个）

### 4. 章节管理
- **➕ 新增章节** - 在末尾添加新章节
- **🗑️ 删除章节** - 删除不需要的章节（至少保留1章）
- 删除后自动重新编号

## 界面布局

```
┌─────────────────────────────────────────┐
│ 教学大纲                       [编辑]   │
├─────────────────────────────────────────┤
│                                          │
│ 單元標題                                 │
│ [________________文本框________________] │
│                                          │
│ 學習目標                      [+ 新增目標]│
│ 1. [___________输入框___________] [×]   │
│ 2. [___________输入框___________] [×]   │
│ 3. [___________输入框___________] [×]   │
│                                          │
│ 教學章節                      [+ 新增章節]│
│ ┌────────────────────────────────┐      │
│ │ 第 1 章                    [🗑️]│      │
│ │                                │      │
│ │ 章節標題                       │      │
│ │ [_____________输入框___________]│      │
│ │                                │      │
│ │ 章節描述                       │      │
│ │ [_____________文本域___________]│      │
│ │                                │      │
│ │ 學習主題              [+ 新增主題]│      │
│ │ [_____主题1_____] [×]         │      │
│ │ [_____主题2_____] [×]         │      │
│ └────────────────────────────────┘      │
│ ┌────────────────────────────────┐      │
│ │ 第 2 章                    [🗑️]│      │
│ │ ...                            │      │
│ └────────────────────────────────┘      │
│                                          │
│ [✓ 儲存編輯]  [取消]                     │
└─────────────────────────────────────────┘
```

## 功能特点

### ✅ 直观操作
- 无需了解JSON格式
- 可视化表单输入
- 实时预览修改

### ✅ 灵活编辑
- 添加/删除目标
- 添加/删除章节
- 添加/删除主题
- 修改任何文本内容

### ✅ 数据验证
- 至少保留1个学习目标
- 至少保留1个章节
- 每个章节至少1个主题
- 章节自动编号

### ✅ 用户友好
- 清晰的标签说明
- 图标按钮
- 删除按钮带确认保护
- 取消功能恢复原始数据

## 使用流程

### 1. 查看大纲
生成大纲后，以美观的卡片形式显示

### 2. 点击"编辑"
进入编辑模式，显示表单界面

### 3. 修改内容
- 修改单元标题
- 添加/删除/修改学习目标
- 添加/删除章节
- 修改章节标题、描述
- 添加/删除/修改主题

### 4. 保存或取消
- **儲存編輯** - 应用更改
- **取消** - 放弃更改，恢复原始数据

### 5. 确认生成
保存后回到查看模式，点击"確認大綱"开始生成教材

## 技术实现

### 数据流

```
JSON字符串 → 解析 → 可视化显示
                   ↓
            [编辑] 编辑表单 (editData状态)
                   ↓
            [保存] → 转换为JSON字符串 → 更新
```

### 状态管理

```javascript
const [parsedOutline, setParsedOutline] = useState(null);  // 原始解析数据
const [editData, setEditData] = useState(null);            // 编辑中的数据
const [isEditing, setIsEditing] = useState(false);         // 编辑模式
```

### 主要函数

- `updateTitle()` - 更新单元标题
- `updateObjective()` - 更新学习目标
- `addObjective()` / `removeObjective()` - 添加/删除目标
- `updateChapter()` - 更新章节信息
- `addChapter()` / `removeChapter()` - 添加/删除章节
- `updateChapterTopic()` - 更新主题
- `addChapterTopic()` / `removeChapterTopic()` - 添加/删除主题

### 编辑模式切换

```javascript
// 进入编辑模式
handleEdit() {
  setIsEditing(true);
  setEditData(深拷贝 parsedOutline);
}

// 保存
handleSave() {
  转换 editData → JSON字符串;
  更新 parsedOutline;
  setIsEditing(false);
}

// 取消
handleCancel() {
  恢复 editData = parsedOutline;
  setIsEditing(false);
}
```

## 优势对比

### 之前（JSON编辑）
❌ 需要了解JSON语法  
❌ 容易出现格式错误  
❌ 不直观  
❌ 技术门槛高  
❌ 容易误删关键字符  

### 现在（可视化编辑）
✅ 无需技术知识  
✅ 不会有格式错误  
✅ 直观易懂  
✅ 零门槛  
✅ 有保护机制  
✅ 操作提示清晰  

## 示例场景

### 场景1：添加学习目标
1. 点击"编辑"
2. 点击"+ 新增目標"
3. 在新增的输入框中输入目标
4. 点击"儲存編輯"

### 场景2：修改章节
1. 点击"编辑"
2. 找到要修改的章节
3. 修改标题、描述或主题
4. 点击"儲存編輯"

### 场景3：重组章节
1. 点击"编辑"
2. 删除不需要的章节（点击 🗑️）
3. 点击"+ 新增章節"添加新章节
4. 修改新章节内容
5. 点击"儲存編輯"

### 场景4：放弃修改
1. 点击"编辑"
2. 做了一些修改
3. 决定不保存
4. 点击"取消" - 所有修改被丢弃

## 注意事项

### 最小要求
- ⚠️ 至少保留 **1个学习目标**
- ⚠️ 至少保留 **1个章节**
- ⚠️ 每个章节至少 **1个主题**

### 自动处理
- ✅ 删除章节后自动重新编号
- ✅ 章节编号总是连续的（1, 2, 3...）
- ✅ 学习目标自动编号

### 数据保护
- 删除按钮在最小数量时会被禁用
- 取消操作可以恢复所有更改
- 保存前数据会自动验证

## 测试建议

1. **基本编辑**
   - 修改单元标题
   - 修改现有目标
   - 修改章节信息

2. **添加内容**
   - 添加新目标
   - 添加新章节
   - 添加新主题

3. **删除内容**
   - 删除多余目标
   - 删除不需要的章节
   - 删除多余主题

4. **边界情况**
   - 尝试删除最后一个目标（应该被阻止）
   - 尝试删除最后一个章节（应该被阻止）
   - 取消编辑查看是否恢复

---

现在用户可以轻松编辑大纲，无需接触JSON！🎉

