# 格式修复说明

## 问题

之前生成的内容中，有两种格式无法正确显示：

### 1. 数学公式使用了 `[ ]` 格式
```
错误：[ \frac{30\text{ km}}{2\text{ h}} = 15\text{ km/h} ]
正确：$\frac{30\text{ km}}{2\text{ h}} = 15\text{ km/h}$
```

### 2. 表格没有被渲染
```
错误显示为纯文本：
| 常用單位 | 讀法 | 什麼情況會用到 |
|----------|------|----------------|
| m/s | 公尺／秒 | 走路、跑步 |
```

## 解决方案

### 1. 添加 GitHub Flavored Markdown (GFM) 支持

安装了 `remark-gfm` 插件，支持：
- ✅ 表格
- ✅ 删除线
- ✅ 任务列表
- ✅ 自动链接
- ✅ 脚注

### 2. 更新所有组件

所有使用 ReactMarkdown 的组件都已更新：

```jsx
import remarkGfm from 'remark-gfm';

<ReactMarkdown 
  remarkPlugins={[remarkMath, remarkGfm]}
  rehypePlugins={[rehypeKatex]}
>
  {content}
</ReactMarkdown>
```

更新的组件：
- ✅ `ChapterDisplay.jsx`
- ✅ `ContentDisplay.jsx`
- ✅ `QuestionsDisplay.jsx`

### 3. 修改后端 Prompt

更新了 AI 的生成指令，明确要求：

**数学公式：**
```
✅ 使用：$v = \frac{d}{t}$
✅ 使用：$$E = mc^2$$
❌ 不要用：[ v = \frac{d}{t} ]
```

**表格：**
```markdown
| 項目 | 說明 |
|------|------|
| 內容1 | 說明1 |
| 內容2 | 說明2 |
```

## 正确的格式示例

### 数学公式

#### 行内公式
```markdown
速率的公式是 $v = \frac{d}{t}$，其中 $v$ 是速率。
```
显示：速率的公式是 *v = d/t*，其中 *v* 是速率。

#### 块级公式
```markdown
$$
\text{速率} = \frac{\text{距離}}{\text{時間}}
$$
```
显示为居中的大型公式。

### 表格

```markdown
| 常用單位 | 讀法 | 什麼情況會用到 |
|----------|------|----------------|
| m/s | 公尺／秒 | 走路、跑步、自由落體 |
| km/h | 公里／小時 | 開車、騎腳踏車 |
| L/min | 公升／分鐘 | 水龍頭流量、呼吸量 |
```

显示为格式化的表格：

| 常用單位 | 讀法 | 什麼情況會用到 |
|----------|------|----------------|
| m/s | 公尺／秒 | 走路、跑步、自由落體 |
| km/h | 公里／小時 | 開車、騎腳踏車 |
| L/min | 公升／分鐘 | 水龍頭流量、呼吸量 |

## 支持的额外 Markdown 功能

### 1. 删除线
```markdown
~~这是删除的文字~~
```

### 2. 任务列表
```markdown
- [x] 已完成的任务
- [ ] 未完成的任务
```

### 3. 自动链接
```markdown
https://example.com
```
自动转换为可点击的链接

### 4. 脚注
```markdown
这是一段文字[^1]

[^1]: 这是脚注内容
```

## 使用方式

### 重新生成教材

由于后端 prompt 已更新，**下次生成新教材时**，AI 会自动使用正确的格式：
- 数学公式使用 `$...$` 或 `$$...$$`
- 表格使用标准 Markdown 表格语法

### 已生成的教材

对于已经生成的教材（使用了 `[ ]` 格式的公式）：
1. 可以在大纲页面点击"编辑"
2. 手动将 `[ ]` 改为 `$...$`
3. 保存后重新生成

## 测试建议

生成一个包含公式和表格的教材：

**测试案例 1：数学**
```
科目：数学
年级：国中二年级
单元：一元二次方程式
```
应包含：公式 $ax^2 + bx + c = 0$

**测试案例 2：物理**
```
科目：物理
年级：国中一年级
单元：速率与速度
```
应包含：公式和单位对照表

**测试案例 3：化学**
```
科目：化学
年级：国中三年级
单元：化学反应式
```
应包含：化学式和反应表格

## 更新内容总结

✅ 添加 `remark-gfm` 支持表格  
✅ 更新所有 Markdown 组件  
✅ 修改后端 prompt 指定正确格式  
✅ 支持更多 Markdown 功能  

---

现在系统完全支持：
- 🧮 数学公式（KaTeX 渲染）
- 📊 表格（自动格式化）
- 📝 其他 GitHub Flavored Markdown 功能

**下次生成新教材时，所有格式都会正确显示！** 🎉

